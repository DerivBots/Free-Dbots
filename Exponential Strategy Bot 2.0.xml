<xml xmlns="https://developers.google.com/blockly/xml" is_dbot="true" collection="false">
  <variables>
    <variable id="]oGV^TW+pyAyI~)S*^8n">Max Loss Amount</variable>
    <variable id="9x[vEnPzcs4#B%.$sHT+">ema</variable>
    <variable id="LmU[8ZH:2aZ)m-5^SQ#w">Initial Amount</variable>
    <variable id="IuS7w^IfF%%reKqf6Qcq">Expected Profit</variable>
    <variable id="~L`ZY7d)mYgNPM=IdL$:">text2</variable>
    <variable id="~dWK^wXlM_X{R;V9TcqB">text3</variable>
    <variable id="fC]G,x^SOuvquuV@-6T-">text4</variable>
    <variable id=",`Y]gHZe/MA.H+HvjCT0">EMA-34</variable>
    <variable id=".}isBXha4T:t(WP]tqFt">Win Amount</variable>
    <variable id="T2Ol)i?;sVB.#G!!xu(d">ema1</variable>
    <variable id="DNib.B0%.tV1gRYu6!cy">EMA-13</variable>
    <variable id="-h%[zY+gM]v|qmD`b}l5">text5</variable>
    <variable id="yR4%pws3q_juNezELQ6v">text</variable>
    <variable id="=A`|/k+cRz.XGcjPt9a~">text1</variable>
    <variable id="atr_value">ATR</variable>
    <variable id="loss_counter">Loss Counter</variable> <!-- New variable for counting losses -->
    <variable id="volatility_threshold">Volatility Threshold</variable> <!-- New variable for dynamic threshold -->
    <variable id="trade_start_time">Trade Start Time</variable> <!-- New variable for managing trade time -->
  </variables>

  <!-- Main trading logic definition -->
  <block type="trade_definition" id="vLLt0bmiS,qfJa7cOlQM" deletable="false" x="0" y="60">
    <statement name="TRADE_OPTIONS">
      <block type="trade_definition_market" id="~PN5_:YS!t8(86x~UY@$" deletable="false" movable="false">
        <field name="MARKET_LIST">synthetic_index</field>
        <field name="SUBMARKET_LIST">random_index</field>
        <field name="SYMBOL_LIST">1HZ100V</field>
        <next>
          <block type="trade_definition_tradetype" id="kI+lKr]bId36V[vCnq:9" deletable="false" movable="false">
            <field name="TRADETYPECAT_LIST">digits</field>
            <field name="TRADETYPE_LIST">evenodd</field>
            <next>
              <block type="trade_definition_contracttype" id="$O*p-*vqH36ILzc6$bR=" deletable="false" movable="false">
                <field name="TYPE_LIST">both</field>
                <next>
                  <block type="trade_definition_candleinterval" id="]R5]i6l*IL_n%Cm([vl," deletable="false" movable="false">
                    <field name="CANDLEINTERVAL_LIST">60</field>
                    <next>
                      <block type="trade_definition_restartbuysell" id="u=.ee`M;hJU../URF1Ns" deletable="false" movable="false">
                        <field name="TIME_MACHINE_ENABLED">FALSE</field>
                        <next>
                          <block type="trade_definition_restartonerror" id="sC[iib{7q@TzYPO#eQT|" deletable="false" movable="false">
                            <field name="RESTARTONERROR">TRUE</field>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>

    <statement name="INITIALIZATION">
      <block type="variables_set" id="5H}7~jXdMd1PaV-J-wF$">
        <field name="VAR" id="]oGV^TW+pyAyI~)S*^8n">Max Loss Amount</field>
        <value name="VALUE">
          <block type="math_number" id="TQVgLrS4$Fu6NT3+^F@e">
            <field name="NUM">20</field>
          </block>
        </value>
        <next>
          <block type="variables_set" id="setLossCounter">
            <field name="VAR" id="loss_counter">Loss Counter</field>
            <value name="VALUE">
              <block type="math_number" id="resetLossCounter">
                <field name="NUM">0</field> <!-- Initializes loss counter to 0 -->
              </block>
            </value>
          </block>
        </next>
        <next>
          <block type="variables_set" id="setVolatilityThreshold">
            <field name="VAR" id="volatility_threshold">Volatility Threshold</field>
            <value name="VALUE">
              <block type="math_number" id="defaultVolatilityThreshold">
                <field name="NUM">2.0</field> <!-- Default volatility threshold -->
              </block>
            </value>
          </block>
        </next>
      </block>
    </statement>

    <!-- Purchase logic with Volatility Filter -->
    <block type="before_purchase" id="^quULY}e);LBrbLXNPym" deletable="false" x="0" y="832">
      <statement name="BEFOREPURCHASE_STACK">

        <!-- ATR Calculation -->
        <block type="atr_statement" id="calculateATR">
          <value name="PERIOD">
            <shadow type="math_number">
              <field name="NUM">14</field>
            </shadow>
          </value>
          <next>
            <block type="variables_set" id="setATRValue">
              <field name="VAR" id="atr_value">ATR</field>
              <value name="VALUE">
                <block type="variables_get">
                  <field name="VAR" id="atr_statement">ATR</field>
                </block>
              </value>
            </block>
          </next>
        </block>

        <!-- Error Handling: Check if ATR is valid -->
        <block type="controls_if" id="checkATRValidity">
          <value name="IF0">
            <block type="logic_compare" id="compareATRValidity">
              <field name="OP">LT</field>
              <value name="A">
                <block type="variables_get">
                  <field name="VAR" id="atr_value">ATR</field>
                </block>
              </value>
              <value name="B">
                <block type="math_number">
                  <field name="NUM">0</field>
                </block>
              </value>
            </block>
          </value>
          <statement name="DO0">
            <block type="notify" id="invalidATRNotification">
              <field name="NOTIFICATION_TYPE">warn</field>
              <field name="NOTIFICATION_SOUND">silent</field>
              <value name="MESSAGE">
                <block type="text">
                  <field name="TEXT">Invalid ATR value. Stopping trade.</field>
                </block>
              </value>
            </block>
            <next>
              <block type="trade_stop" id="stopBotOnInvalidATR">
                <!-- Stops the bot when ATR is invalid -->
              </block>
            </next>
          </statement>
        </block>

        <!-- Volatility Filter -->
        <block type="controls_if" id="checkVolatility">
          <value name="IF0">
            <block type="logic_compare" id="compareATR">
              <field name="OP">GT</field> <!-- Check if ATR > threshold -->
              <value name="A">
                <block type="variables_get">
                  <field name="VAR" id="atr_value">ATR</field>
                </block>
              </value>
              <value name="B">
                <block type="variables_get
